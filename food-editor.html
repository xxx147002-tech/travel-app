<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ½ï¸ ç¾é£Ÿæ¸…å–®ç·¨è¼¯å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(72, 187, 120, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 101, 101, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-tag {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .category-tag .delete-btn {
            background: rgba(0, 0, 0, 0.2);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 14px;
            line-height: 1;
        }

        .food-list {
            display: grid;
            gap: 15px;
        }

        .food-item {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            cursor: move;
        }

        .food-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .food-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .food-item-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .food-item-rating {
            color: #f59e0b;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .food-item-info {
            color: #718096;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .food-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .food-item-actions .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .export-section {
            margin-top: 20px;
        }

        .export-preview {
            background: #1a202c;
            color: #48bb78;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 1.2rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ½ï¸ ç¾é£Ÿæ¸…å–®ç·¨è¼¯å™¨</h1>
            <p>ç®¡ç†æ‚¨çš„æ—…éŠç¾é£Ÿæ¸…å–®ï¼Œæ”¯æ´åˆ†é¡èˆ‡åŒ¯å‡ºåŠŸèƒ½</p>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left: Food List -->
            <div class="card">
                <h2>ğŸ“‹ ç¾é£Ÿæ¸…å–®</h2>

                <!-- Statistics -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-count">0</div>
                        <div class="stat-label">ç¸½å…±é¤å»³</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="category-count">0</div>
                        <div class="stat-label">åˆ†é¡æ•¸é‡</div>
                    </div>
                </div>

                <!-- Food Items -->
                <div class="food-list" id="food-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ´</div>
                        <div class="empty-state-text">å°šç„¡ç¾é£Ÿè³‡æ–™ï¼Œè«‹é–‹å§‹æ–°å¢ï¼</div>
                    </div>
                </div>
            </div>

            <!-- Right: Add Food & Categories -->
            <div>
                <!-- Add Food Form -->
                <div class="card">
                    <h2>â• æ–°å¢ç¾é£Ÿ</h2>
                    <form id="food-form">
                        <div class="form-group">
                            <label for="food-name">é¤å»³åç¨± *</label>
                            <input type="text" id="food-name" placeholder="ä¾‹ï¼šæ˜Ÿå…‰æµ·æ´‹ç‰§å ´" required>
                        </div>
                        <div class="form-group">
                            <label for="food-address">åœ°å€</label>
                            <input type="text" id="food-address" placeholder="ä¾‹ï¼šæ¾æ¹–ç¸£æ¹–è¥¿é„‰åŒ—å¯®æ‘">
                        </div>
                        <div class="form-group">
                            <label for="food-hours">ç‡Ÿæ¥­æ™‚é–“</label>
                            <input type="text" id="food-hours" placeholder="ä¾‹ï¼š10:00 - 18:00">
                        </div>
                        <div class="form-group">
                            <label for="food-rating">Google è©•åˆ†</label>
                            <input type="number" id="food-rating" min="0" max="5" step="0.1" placeholder="ä¾‹ï¼š4.5">
                        </div>
                        <div class="form-group">
                            <label for="food-category">åˆ†é¡</label>
                            <select id="food-category" required>
                                <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="food-map">Google Maps é€£çµ</label>
                            <input type="url" id="food-map" placeholder="è²¼ä¸Š Google Maps é€£çµ">
                        </div>
                        <div class="action-buttons">
                            <button type="submit" class="btn btn-primary">
                                <span>â•</span>
                                <span id="form-submit-text">æ–°å¢é¤å»³</span>
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit" style="display: none;">
                                <span>âœ–ï¸</span>
                                <span>å–æ¶ˆç·¨è¼¯</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Category Management -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ·ï¸ åˆ†é¡ç®¡ç†</h2>
                    <div class="category-list" id="category-list">
                        <!-- Categories will be added here -->
                    </div>
                    <div class="form-group">
                        <label for="new-category">æ–°å¢åˆ†é¡</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="new-category" placeholder="ä¾‹ï¼šæ¾æ¹–å¸‚å€">
                            <input type="color" id="category-color" value="#667eea"
                                style="width: 60px; height: 46px; border: none;">
                        </div>
                    </div>
                    <button class="btn btn-success" id="add-category-btn">
                        <span>â•</span>
                        <span>æ–°å¢åˆ†é¡</span>
                    </button>
                </div>

                <!-- Batch Import Section -->
                <div class="card" style="margin-top: 20px;">
                    <h2>âš¡ æ‰¹æ¬¡åŒ¯å…¥</h2>
                    <p style="color: #718096; margin-bottom: 15px; font-size: 0.95rem;">
                        å¿«é€ŸåŒ¯å…¥å¤šå€‹é¤å»³ï¼æ¯è¡Œä¸€å€‹é¤å»³ï¼Œæ”¯æ´å¤šç¨®æ ¼å¼
                    </p>

                    <div class="form-group">
                        <label for="batch-category">é è¨­åˆ†é¡ *</label>
                        <select id="batch-category">
                            <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="batch-input">è²¼ä¸Šé¤å»³æ¸…å–®ï¼ˆæ¯è¡Œä¸€ç­†ï¼‰</label>
                        <textarea id="batch-input" placeholder="æ”¯æ´ä»¥ä¸‹æ ¼å¼ï¼š

æ–¹å¼1 - åƒ…åç¨±ï¼š
æ˜Ÿå…‰æµ·æ´‹ç‰§å ´
æ—¥æ–°é¤å»³
å‰è²åˆ¥é‡é¤å»³

æ–¹å¼2 - åç¨± | è©•åˆ†ï¼š
æ˜Ÿå…‰æµ·æ´‹ç‰§å ´ | 4.5
æ—¥æ–°é¤å»³ | 4.3

æ–¹å¼3 - å®Œæ•´è³‡è¨Šï¼ˆç”¨ | åˆ†éš”ï¼‰ï¼š
æ˜Ÿå…‰æµ·æ´‹ç‰§å ´ | æ¾æ¹–ç¸£æ¹–è¥¿é„‰ | 10:00-18:00 | 4.5 | https://maps.app.goo.gl/xxx" style="min-height: 200px;"></textarea>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-success" id="batch-import-btn">
                            <span>âš¡</span>
                            <span>æ‰¹æ¬¡åŒ¯å…¥</span>
                        </button>
                        <button class="btn btn-secondary" id="clear-batch-btn">
                            <span>ğŸ—‘ï¸</span>
                            <span>æ¸…é™¤</span>
                        </button>
                    </div>

                    <div id="batch-result"
                        style="margin-top: 15px; padding: 15px; background: #f7fafc; border-radius: 10px; display: none;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 5px;">åŒ¯å…¥çµæœï¼š</div>
                        <div id="batch-result-text" style="color: #718096;"></div>
                    </div>
                </div>

                <!-- Export Section -->
                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ’¾ åŒ¯å‡ºè³‡æ–™</h2>
                    <p style="color: #718096; margin-bottom: 15px; font-size: 0.95rem;">
                        å°‡è³‡æ–™åŒ¯å‡ºç‚º JSON æ ¼å¼ï¼Œå¯è¤‡è£½åˆ° APP ä¸­ä½¿ç”¨
                    </p>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="export-json-btn">
                            <span>ğŸ“¦</span>
                            <span>åŒ¯å‡º JSON</span>
                        </button>
                        <button class="btn btn-secondary" id="copy-json-btn" style="display: none;">
                            <span>ğŸ“‹</span>
                            <span>è¤‡è£½åˆ°å‰ªè²¼ç°¿</span>
                        </button>
                    </div>
                    <div class="export-preview" id="export-preview" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™çµæ§‹
        let foodList = [];
        let categories = [];
        let editingId = null;

        // åˆå§‹åŒ–
        function init() {
            loadData();
            updateDisplay();
            setupEventListeners();

            // å¦‚æœæ²’æœ‰åˆ†é¡ï¼Œæ–°å¢é è¨­åˆ†é¡
            if (categories.length === 0) {
                categories = [
                    { id: 'penghu-city', name: 'æ¾æ¹–å¸‚å€', color: '#667eea' },
                    { id: 'penghu-island', name: 'æ¾æ¹–ç’°å³¶', color: '#48bb78' }
                ];
                saveData();
            }
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            document.getElementById('food-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('add-category-btn').addEventListener('click', addCategory);
            document.getElementById('export-json-btn').addEventListener('click', exportJSON);
            document.getElementById('copy-json-btn').addEventListener('click', copyToClipboard);
            document.getElementById('cancel-edit').addEventListener('click', cancelEdit);
            document.getElementById('batch-import-btn').addEventListener('click', batchImport);
            document.getElementById('clear-batch-btn').addEventListener('click', clearBatch);
        }

        // è¡¨å–®æäº¤
        function handleFormSubmit(e) {
            e.preventDefault();

            const foodData = {
                id: editingId || Date.now().toString(),
                name: document.getElementById('food-name').value,
                address: document.getElementById('food-address').value,
                hours: document.getElementById('food-hours').value,
                rating: parseFloat(document.getElementById('food-rating').value) || 0,
                category: document.getElementById('food-category').value,
                mapUrl: document.getElementById('food-map').value
            };

            if (editingId) {
                // ç·¨è¼¯ç¾æœ‰é …ç›®
                const index = foodList.findIndex(item => item.id === editingId);
                foodList[index] = foodData;
                editingId = null;
            } else {
                // æ–°å¢é …ç›®
                foodList.push(foodData);
            }

            saveData();
            updateDisplay();
            resetForm();
        }

        // æ–°å¢åˆ†é¡
        function addCategory() {
            const name = document.getElementById('new-category').value.trim();
            const color = document.getElementById('category-color').value;

            if (!name) {
                alert('è«‹è¼¸å…¥åˆ†é¡åç¨±');
                return;
            }

            const category = {
                id: Date.now().toString(),
                name: name,
                color: color
            };

            categories.push(category);
            saveData();
            updateDisplay();

            document.getElementById('new-category').value = '';
        }

        // åˆªé™¤åˆ†é¡
        function deleteCategory(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤åˆ†é¡å—ï¼Ÿä½¿ç”¨æ­¤åˆ†é¡çš„é¤å»³å°‡éœ€è¦é‡æ–°åˆ†é¡ã€‚')) {
                categories = categories.filter(cat => cat.id !== id);
                saveData();
                updateDisplay();
            }
        }

        // ç·¨è¼¯ç¾é£Ÿ
        function editFood(id) {
            const food = foodList.find(item => item.id === id);
            if (!food) return;

            editingId = id;
            document.getElementById('food-name').value = food.name;
            document.getElementById('food-address').value = food.address;
            document.getElementById('food-hours').value = food.hours;
            document.getElementById('food-rating').value = food.rating;
            document.getElementById('food-category').value = food.category;
            document.getElementById('food-map').value = food.mapUrl;

            document.getElementById('form-submit-text').textContent = 'æ›´æ–°é¤å»³';
            document.getElementById('cancel-edit').style.display = 'inline-flex';

            // æ»¾å‹•åˆ°è¡¨å–®
            document.getElementById('food-form').scrollIntoView({ behavior: 'smooth' });
        }

        // åˆªé™¤ç¾é£Ÿ
        function deleteFood(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é¤å»³å—ï¼Ÿ')) {
                foodList = foodList.filter(item => item.id !== id);
                saveData();
                updateDisplay();
            }
        }

        // å–æ¶ˆç·¨è¼¯
        function cancelEdit() {
            editingId = null;
            resetForm();
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            document.getElementById('food-form').reset();
            document.getElementById('form-submit-text').textContent = 'æ–°å¢é¤å»³';
            document.getElementById('cancel-edit').style.display = 'none';
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            updateStats();
            updateCategoryList();
            updateCategorySelect();
            updateFoodList();
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('total-count').textContent = foodList.length;
            document.getElementById('category-count').textContent = categories.length;
        }

        // æ›´æ–°åˆ†é¡æ¸…å–®
        function updateCategoryList() {
            const container = document.getElementById('category-list');

            if (categories.length === 0) {
                container.innerHTML = '<p style="color: #a0aec0;">å°šç„¡åˆ†é¡</p>';
                return;
            }

            container.innerHTML = categories.map(cat => `
                <div class="category-tag" style="background-color: ${cat.color}; color: white;">
                    <span>${cat.name}</span>
                    <button class="delete-btn" onclick="deleteCategory('${cat.id}')">Ã—</button>
                </div>
            `).join('');
        }

        // æ›´æ–°åˆ†é¡é¸æ“‡å™¨
        function updateCategorySelect() {
            const select = document.getElementById('food-category');
            const batchSelect = document.getElementById('batch-category');
            const currentValue = select.value;
            const batchCurrentValue = batchSelect.value;

            const optionsHTML = '<option value="">è«‹é¸æ“‡åˆ†é¡</option>' +
                categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');

            select.innerHTML = optionsHTML;
            batchSelect.innerHTML = optionsHTML;

            if (currentValue) {
                select.value = currentValue;
            }

            if (batchCurrentValue) {
                batchSelect.value = batchCurrentValue;
            }
        }

        // æ›´æ–°ç¾é£Ÿæ¸…å–®
        function updateFoodList() {
            const container = document.getElementById('food-list');

            if (foodList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ´</div>
                        <div class="empty-state-text">å°šç„¡ç¾é£Ÿè³‡æ–™ï¼Œè«‹é–‹å§‹æ–°å¢ï¼</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = foodList.map(food => {
                const category = categories.find(cat => cat.id === food.category);
                const categoryName = category ? category.name : 'æœªåˆ†é¡';
                const categoryColor = category ? category.color : '#a0aec0';

                return `
                    <div class="food-item">
                        <div class="food-item-header">
                            <div>
                                <div class="food-item-title">${food.name}</div>
                                <div class="category-tag" style="background-color: ${categoryColor}; color: white; display: inline-flex;">
                                    ${categoryName}
                                </div>
                            </div>
                            ${food.rating > 0 ? `<div class="food-item-rating">â­ ${food.rating}</div>` : ''}
                        </div>
                        ${food.address ? `<div class="food-item-info">ğŸ“ ${food.address}</div>` : ''}
                        ${food.hours ? `<div class="food-item-info">ğŸ• ${food.hours}</div>` : ''}
                        ${food.mapUrl ? `<div class="food-item-info"><a href="${food.mapUrl}" target="_blank" style="color: #667eea;">ğŸ—ºï¸ æŸ¥çœ‹åœ°åœ–</a></div>` : ''}
                        <div class="food-item-actions">
                            <button class="btn btn-secondary" onclick="editFood('${food.id}')">
                                <span>âœï¸</span>
                                <span>ç·¨è¼¯</span>
                            </button>
                            <button class="btn btn-danger" onclick="deleteFood('${food.id}')">
                                <span>ğŸ—‘ï¸</span>
                                <span>åˆªé™¤</span>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŒ¯å‡º JSON
        function exportJSON() {
            const exportData = {
                categories: categories,
                foodList: foodList
            };

            const json = JSON.stringify(exportData, null, 2);
            const preview = document.getElementById('export-preview');

            preview.textContent = json;
            preview.style.display = 'block';
            document.getElementById('copy-json-btn').style.display = 'inline-flex';
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        function copyToClipboard() {
            const text = document.getElementById('export-preview').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }).catch(err => {
                alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        // å„²å­˜è³‡æ–™åˆ° LocalStorage
        function saveData() {
            localStorage.setItem('foodList', JSON.stringify(foodList));
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        // è¼‰å…¥è³‡æ–™
        function loadData() {
            const savedFoodList = localStorage.getItem('foodList');
            const savedCategories = localStorage.getItem('categories');

            if (savedFoodList) {
                foodList = JSON.parse(savedFoodList);
            }

            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            }
        }

        // æ‰¹æ¬¡åŒ¯å…¥
        function batchImport() {
            const input = document.getElementById('batch-input').value.trim();
            const category = document.getElementById('batch-category').value;

            if (!input) {
                alert('è«‹è²¼ä¸Šé¤å»³æ¸…å–®');
                return;
            }

            if (!category) {
                alert('è«‹é¸æ“‡é è¨­åˆ†é¡');
                return;
            }

            const lines = input.split('\n').filter(line => line.trim());
            let successCount = 0;
            let skipCount = 0;

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // è§£æä¸åŒæ ¼å¼
                const parts = line.split('|').map(p => p.trim());

                let name, address, hours, rating, mapUrl;

                if (parts.length === 1) {
                    // æ ¼å¼1: åƒ…åç¨±
                    name = parts[0];
                } else if (parts.length === 2) {
                    // æ ¼å¼2: åç¨± | è©•åˆ†
                    name = parts[0];
                    rating = parseFloat(parts[1]) || 0;
                } else if (parts.length >= 3) {
                    // æ ¼å¼3: åç¨± | åœ°å€ | ç‡Ÿæ¥­æ™‚é–“ | è©•åˆ† | åœ°åœ–é€£çµ
                    name = parts[0];
                    address = parts[1] || '';
                    hours = parts[2] || '';
                    rating = parseFloat(parts[3]) || 0;
                    mapUrl = parts[4] || '';
                }

                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const exists = foodList.some(food => food.name === name);
                if (exists) {
                    skipCount++;
                    return;
                }

                // æ–°å¢é¤å»³
                const foodData = {
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                    name: name,
                    address: address || '',
                    hours: hours || '',
                    rating: rating || 0,
                    category: category,
                    mapUrl: mapUrl || ''
                };

                foodList.push(foodData);
                successCount++;

                // é¿å…æ™‚é–“æˆ³é‡è¤‡
                if (successCount < lines.length) {
                    const delay = Math.random() * 10;
                }
            });

            saveData();
            updateDisplay();

            // é¡¯ç¤ºçµæœ
            const resultDiv = document.getElementById('batch-result');
            const resultText = document.getElementById('batch-result-text');
            resultDiv.style.display = 'block';
            resultText.innerHTML = `
                âœ… æˆåŠŸåŒ¯å…¥ <strong>${successCount}</strong> å€‹é¤å»³<br>
                ${skipCount > 0 ? `âš ï¸ è·³é <strong>${skipCount}</strong> å€‹é‡è¤‡çš„é¤å»³` : ''}
            `;

            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('batch-input').value = '';

            // 3ç§’å¾Œéš±è—çµæœ
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        // æ¸…é™¤æ‰¹æ¬¡è¼¸å…¥
        function clearBatch() {
            document.getElementById('batch-input').value = '';
            document.getElementById('batch-result').style.display = 'none';
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        init();
    </script>
</body>

</html>